'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'ui.bootstrap']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($scope, $http) {

	$scope.filteredData;
	$scope.currentWords;
	$scope.rating = {};
	$scope.done = false;
	$scope.$watch('rating.selected', function (newValue, oldValue) {
		if (!newValue || !$scope.filteredData) return;
		if (newValue === 1) {
			$scope.createWords(newValue);
		} else {
			$scope.createWords(newValue / 2);
		}
	});

	$scope.getReviews = function () {
		$http.get('/api/reviews', $scope.API).then(function (response) {
			return JSON.parse(response.data);
		}).then(function (data) {
			$scope.filteredData = translateData(data);
			$scope.done = true;
			console.log('Data has arrived!');
		})['catch'](function (err) {
			console.error(err);
		});
	};

	function translateData(data) {
		var filteredData = {};
		for (var rating in data) {
			if (rating && !isNaN(rating)) {

				filteredData[rating] = {};
				data[rating].filter(function (taggedWord) {
					return taggedWord[1] === 'JJ' && taggedWord[0][0] !== '\'';
				}).forEach(function (taggedAdjectives) {
					filteredData[rating][taggedAdjectives[0]] = ++filteredData[rating][taggedAdjectives[0]] || 1;
				});

				filteredData[rating] = Object.keys(filteredData[rating]).sort(function (a, b) {
					return filteredData[rating][a] - filteredData[rating][b];
				}).reverse().splice(0, 20);
			}
		};
		return filteredData;
	}

	$scope.createWords = function (stars) {
		$scope.currentWords = $scope.filteredData[stars];
		d3.select('#wordCloud').remove();
		var fill = d3.scale.category20();
		var layout = d3.layout.cloud().size([500, 500]).words($scope.currentWords.map(function (d) {
			return {
				text: d,
				size: 10 + Math.random() * 90,
				test: 'haha'
			};
		})).padding(5).rotate(function () {
			var negRandom = Math.random() < 0.5 ? -1 : 1;
			return ~ ~(Math.random() * 2) * 60 * negRandom;
		}).font('Helvetica Neue').fontSize(function (d) {
			return d.size;
		}).on('end', draw);
		layout.start();

		function draw(words) {
			d3.select('#demo').append('svg').attr('id', 'wordCloud').attr('width', layout.size()[0]).attr('height', layout.size()[1]).append('g').attr('transform', 'translate(' + layout.size()[0] / 2 + ',' + layout.size()[1] / 2 + ')').selectAll('text').data(words).enter().append('text').style('font-size', function (d) {
				return d.size + 'px';
			}).style('font-family', 'Helvetica Neue').style('fill', function (d, i) {
				return fill(i);
			}).attr('text-anchor', 'middle').attr('transform', function (d) {
				return 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')';
			}).text(function (d) {
				return d.text;
			});
		}
	};
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
'use strict';

app.controller('ModulesController', function ($scope, $http, ModulesFactory) {

  $scope.$on('$stateChangeSuccess', function () {
    var defaultMessage = 'If you don\'t see a list of links here, you need to seed your database!\nIn your terminal, go to this app\'s directory and run `gulp seedDB`.\nThen try this page again.';

    ModulesFactory.getNodeModules().then(function (modules) {
      $scope.nodeModules = modules;

      if (!$scope.nodeModules.length) {
        $scope.defaultMessage = defaultMessage;
      }
    });
  });
});
'use strict';

app.factory('ModulesFactory', function ($http) {
  return {
    getNodeModules: function getNodeModules() {
      return $http.get('/api/modules/').then(function (res) {
        return res.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('modules', {
        url: '/modules',
        templateUrl: '/app/modules/modules.html',
        controller: 'ModulesController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLnN0YXRlLmpzIiwibW9kdWxlcy9tb2R1bGVzLmNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL21vZHVsZXMuZmFjdG9yeS5qcyIsIm1vZHVsZXMvbW9kdWxlcy5zdGF0ZS5qcyIsIm5hdmJhci9uYXZiYXIuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQzs7QUFFdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLGtCQUFrQixFQUFFLGlCQUFpQixFQUFFOztBQUV6RCxvQkFBaUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRWxDLHFCQUFrQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztDQUNwQyxDQUFDLENBQUM7OztBQ1BILEdBQUcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLEVBQUUsVUFBUyxNQUFNLEVBQUUsS0FBSyxFQUFFOztBQUV2RCxPQUFNLENBQUMsWUFBWSxDQUFDO0FBQ3BCLE9BQU0sQ0FBQyxZQUFZLENBQUM7QUFDcEIsT0FBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDbkIsT0FBTSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7QUFDcEIsT0FBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxVQUFVLFFBQVEsRUFBRSxRQUFRLEVBQUU7QUFDOUQsTUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsT0FBTztBQUM5QyxNQUFJLFFBQVEsS0FBSyxDQUFDLEVBQUU7QUFDbkIsU0FBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtHQUM1QixNQUFNO0FBQ04sU0FBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEdBQUMsQ0FBQyxD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YyxHQUFHLDBLQUEwSyxDQUFDOztBQUVoTSxrQkFBYyxDQUFDLGNBQWMsRUFBRSxDQUM1QixJQUFJLENBQUMsVUFBUyxPQUFPLEVBQUU7QUFDdEIsWUFBTSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7O0FBRTdCLFVBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtBQUM5QixjQUFNLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztPQUN4QztLQUNGLENBQUMsQ0FBQztHQUNOLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQzs7O0FDZEgsR0FBRyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxVQUFTLEtBQUssRUFBRTtBQUM1QyxTQUFPO0FBQ0wsa0JBQWMsRUFBRSwwQkFBVztBQUN6QixhQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQzlCLElBQUksQ0FBQyxVQUFTLEdBQUcsRUFBRTtBQUNsQixlQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUM7T0FDakIsQ0FBQyxDQUFDO0tBQ047R0FDRixDQUFDO0NBQ0gsQ0FBQyxDQUFDOzs7QUNUSCxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsY0FBYyxFQUFFO0FBQ2pDLGtCQUFjLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRTtBQUM1QixXQUFHLEVBQUUsVUFBVTtBQUNmLG1CQUFXLEVBQUUsMkJBQTJCO0FBQ3hDLGtCQUFVLEVBQUUsbUJBQW1CO0tBQ2xDLENBQUMsQ0FBQztDQUNOLENBQUMsQ0FBQzs7O0FDTkgsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsWUFBVTtBQUNqQyxRQUFPO0FBQ04sVUFBUSxFQUFFLEdBQUc7QUFDYixhQUFXLEVBQUUseUJBQXlCO0VBQ3RDLENBQUM7Q0FDRixDQUFDLENBQUMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnTWVhbmlzY3VsZScsIFsndWkucm91dGVyJywgJ3VpLmJvb3RzdHJhcCddKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xuICAgLy8gVGhpcyB0dXJucyBvZmYgaGFzaGJhbmcgdXJscyAoLyNhYm91dCkgYW5kIGNoYW5nZXMgaXQgdG8gc29tZXRoaW5nIG5vcm1hbCAoL2Fib3V0KVxuICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuICAgLy8gSWYgd2UgZ28gdG8gYSBVUkwgdGhhdCB1aS1yb3V0ZXIgZG9lc24ndCBoYXZlIHJlZ2lzdGVyZWQsIGdvIHRvIHRoZSBcIi9cIiB1cmwuXG4gICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59KTsiLCJhcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG5cblx0XHQkc2NvcGUuZmlsdGVyZWREYXRhO1xuXHRcdCRzY29wZS5jdXJyZW50V29yZHM7XG5cdFx0JHNjb3BlLnJhdGluZyA9IHt9O1xuXHRcdCRzY29wZS5kb25lID0gZmFsc2U7XG5cdFx0JHNjb3BlLiR3YXRjaCgncmF0aW5nLnNlbGVjdGVkJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuXHRcdFx0aWYgKCFuZXdWYWx1ZSB8fCAhJHNjb3BlLmZpbHRlcmVkRGF0YSkgcmV0dXJuO1xuXHRcdFx0aWYgKG5ld1ZhbHVlID09PSAxKSB7XG5cdFx0XHRcdCRzY29wZS5jcmVhdGVXb3JkcyhuZXdWYWx1ZSlcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRzY29wZS5jcmVhdGVXb3JkcyhuZXdWYWx1ZS8yKTtcblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0JHNjb3BlLmdldFJldmlld3MgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkaHR0cC5nZXQoJy9hcGkvcmV2aWV3cycsICRzY29wZS5BUEkpXG5cdFx0XHQudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRyZXR1cm4gSlNPTi5wYXJzZShyZXNwb25zZS5kYXRhKTtcblx0XHRcdH0pXG5cdFx0XHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHQkc2NvcGUuZmlsdGVyZWREYXRhID0gdHJhbnNsYXRlRGF0YShkYXRhKTtcblx0XHRcdFx0JHNjb3BlLmRvbmUgPSB0cnVlO1xuXHRcdFx0XHRjb25zb2xlLmxvZygnRGF0YSBoYXMgYXJyaXZlZCEnKTtcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHR9KVxuXHRcdH1cblxuXHRmdW5jdGlvbiB0cmFuc2xhdGVEYXRhKGRhdGEpIHtcblx0XHR2YXIgZmlsdGVyZWREYXRhID0ge307XG5cdFx0Zm9yICh2YXIgcmF0aW5nIGluIGRhdGEpIHtcblx0XHRcdGlmIChyYXRpbmcgJiYgIWlzTmFOKHJhdGluZykpIHtcblxuXHRcdFx0XHRmaWx0ZXJlZERhdGFbcmF0aW5nXSA9IHt9O1xuXHRcdFx0XHRkYXRhW3JhdGluZ11cblx0XHRcdFx0XHQuZmlsdGVyKGZ1bmN0aW9uKHRhZ2dlZFdvcmQpIHtcblx0XHRcdFx0XHRcdHJldHVybiB0YWdnZWRXb3JkWzFdID09PSAnSkonICYmIHRhZ2dlZFdvcmRbMF1bMF0gIT09IFwiJ1wiO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmZvckVhY2goZnVuY3Rpb24odGFnZ2VkQWRqZWN0aXZlcykge1xuXHRcdFx0XHRcdFx0ZmlsdGVyZWREYXRhW3JhdGluZ11bdGFnZ2VkQWRqZWN0aXZlc1swXV0gPSArK2ZpbHRlcmVkRGF0YVtyYXRpbmddW3RhZ2dlZEFkamVjdGl2ZXNbMF1dIHx8IDE7XG5cdFx0XHRcdFx0fSlcblxuXHRcdFx0XHRmaWx0ZXJlZERhdGFbcmF0aW5nXSA9IE9iamVjdC5rZXlzKGZpbHRlcmVkRGF0YVtyYXRpbmddKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsdGVyZWREYXRhW3JhdGluZ11bYV0gLSBmaWx0ZXJlZERhdGFbcmF0aW5nXVtiXVxuXHRcdFx0XHR9KS5yZXZlcnNlKCkuc3BsaWNlKDAsIDIwKTtcblx0XHRcdH1cblx0XHR9O1xuXHRcdHJldHVybiBmaWx0ZXJlZERhdGE7XG5cdH1cblxuXHQkc2NvcGUuY3JlYXRlV29yZHMgPSBmdW5jdGlvbihzdGFycykge1xuXHRcdCRzY29wZS5jdXJyZW50V29yZHMgPSAkc2NvcGUuZmlsdGVyZWREYXRhW3N0YXJzXVxuXHRcdGQzLnNlbGVjdChcIiN3b3JkQ2xvdWRcIikucmVtb3ZlKCk7XG5cdFx0dmFyIGZpbGwgPSBkMy5zY2FsZS5jYXRlZ29yeTIwKCk7XG5cdFx0dmFyIGxheW91dCA9IGQzLmxheW91dC5jbG91ZCgpXG5cdFx0XHQuc2l6ZShbNTAwLCA1MDBdKVxuXHRcdFx0LndvcmRzKCRzY29wZS5jdXJyZW50V29yZHMubWFwKGZ1bmN0aW9uKGQpIHtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHR0ZXh0OiBkLFxuXHRcdFx0XHRcdHNpemU6IDEwICsgTWF0aC5yYW5kb20oKSAqIDkwLFxuXHRcdFx0XHRcdHRlc3Q6IFwiaGFoYVwiXG5cdFx0XHRcdH07XG5cdFx0XHR9KSlcblx0XHRcdC5wYWRkaW5nKDUpXG5cdFx0XHQucm90YXRlKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgbmVnUmFuZG9tID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcblx0XHRcdFx0cmV0dXJuIH5+KE1hdGgucmFuZG9tKCkgKiAyKSAqIDYwICogbmVnUmFuZG9tO1xuXHRcdFx0fSlcblx0XHRcdC5mb250KFwiSGVsdmV0aWNhIE5ldWVcIilcblx0XHRcdC5mb250U2l6ZShmdW5jdGlvbihkKSB7XG5cdFx0XHRcdHJldHVybiBkLnNpemU7XG5cdFx0XHR9KVxuXHRcdFx0Lm9uKFwiZW5kXCIsIGRyYXcpO1xuXHRcdGxheW91dC5zdGFydCgpO1xuXG5cdFx0ZnVuY3Rpb24gZHJhdyh3b3Jkcykge1xuXHRcdFx0ZDMuc2VsZWN0KFwiI2RlbW9cIikuYXBwZW5kKFwic3ZnXCIpXG5cdFx0XHRcdC5hdHRyKFwiaWRcIixcIndvcmRDbG91ZFwiKVxuXHRcdFx0XHQuYXR0cihcIndpZHRoXCIsIGxheW91dC5zaXplKClbMF0pXG5cdFx0XHRcdC5hdHRyKFwiaGVpZ2h0XCIsIGxheW91dC5zaXplKClbMV0pXG5cdFx0XHRcdC5hcHBlbmQoXCJnXCIpXG5cdFx0XHRcdC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbGF5b3V0LnNpemUoKVswXSAvIDIgKyBcIixcIiArIGxheW91dC5zaXplKClbMV0gLyAyICsgXCIpXCIpXG5cdFx0XHRcdC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG5cdFx0XHRcdC5kYXRhKHdvcmRzKVxuXHRcdFx0XHQuZW50ZXIoKS5hcHBlbmQoXCJ0ZXh0XCIpXG5cdFx0XHRcdC5zdHlsZShcImZvbnQtc2l6ZVwiLCBmdW5jdGlvbihkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGQuc2l6ZSArIFwicHhcIjtcblx0XHRcdFx0fSlcblx0XHRcdFx0LnN0eWxlKFwiZm9udC1mYW1pbHlcIiwgXCJIZWx2ZXRpY2EgTmV1ZVwiKVxuXHRcdFx0XHQuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uKGQsIGkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsbChpKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0LmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuXHRcdFx0XHQuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFwidHJhbnNsYXRlKFwiICsgW2QueCwgZC55XSArIFwiKXJvdGF0ZShcIiArIGQucm90YXRlICsgXCIpXCI7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50ZXh0KGZ1bmN0aW9uKGQpIHtcblx0XHRcdFx0XHRyZXR1cm4gZC50ZXh0O1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH1cblxufSk7IiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaG9tZScsIHtcbiAgICAgICAgdXJsOiAnLycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2hvbWUuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcidcbiAgICB9KTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdNb2R1bGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIE1vZHVsZXNGYWN0b3J5KSB7XG4gIFxuICAkc2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBkZWZhdWx0TWVzc2FnZSA9ICdJZiB5b3UgZG9uXFwndCBzZWUgYSBsaXN0IG9mIGxpbmtzIGhlcmUsIHlvdSBuZWVkIHRvIHNlZWQgeW91ciBkYXRhYmFzZSFcXG5JbiB5b3VyIHRlcm1pbmFsLCBnbyB0byB0aGlzIGFwcFxcJ3MgZGlyZWN0b3J5IGFuZCBydW4gYGd1bHAgc2VlZERCYC5cXG5UaGVuIHRyeSB0aGlzIHBhZ2UgYWdhaW4uJztcblxuICAgIE1vZHVsZXNGYWN0b3J5LmdldE5vZGVNb2R1bGVzKClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKG1vZHVsZXMpIHtcbiAgICAgICAgJHNjb3BlLm5vZGVNb2R1bGVzID0gbW9kdWxlcztcbiAgICAgICAgXG4gICAgICAgIGlmICghJHNjb3BlLm5vZGVNb2R1bGVzLmxlbmd0aCkge1xuICAgICAgICAgICRzY29wZS5kZWZhdWx0TWVzc2FnZSA9IGRlZmF1bHRNZXNzYWdlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfSk7XG59KTsiLCJhcHAuZmFjdG9yeSgnTW9kdWxlc0ZhY3RvcnknLCBmdW5jdGlvbigkaHR0cCkge1xuICByZXR1cm4ge1xuICAgIGdldE5vZGVNb2R1bGVzOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvbW9kdWxlcy8nKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmRhdGE7XG4gICAgICAgIH0pOyAgICBcbiAgICB9XG4gIH07XG59KTsiLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdtb2R1bGVzJywge1xuICAgICAgICB1cmw6ICcvbW9kdWxlcycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9tb2R1bGVzL21vZHVsZXMuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdNb2R1bGVzQ29udHJvbGxlcidcbiAgICB9KTtcbn0pOyIsImFwcC5kaXJlY3RpdmUoXCJuYXZiYXJcIiwgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogXCJFXCIsXG5cdFx0dGVtcGxhdGVVcmw6IFwiL2FwcC9uYXZiYXIvbmF2YmFyLmh0bWxcIlxuXHR9O1xufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9