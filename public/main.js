'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'ui.bootstrap']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($scope, $http) {

	$scope.filteredData;
	$scope.currentWords;
	$scope.rating = {};
	$scope.done = false;
	$scope.$watch('rating.selected', function (newValue, oldValue) {
		if (!newValue || !$scope.filteredData) return;
		if (newValue === 1) {
			$scope.createWords(newValue);
		} else {
			$scope.createWords(newValue / 2);
		}
	});

	$scope.getReviews = function () {
		$http.get('/api/reviews').then(function (response) {
			return JSON.parse(response.data);
		}).then(function (data) {
			$scope.filteredData = translateData(data);
			$scope.done = true;
			console.log('Data has arrived!');
		})['catch'](function (err) {
			console.error(err);
		});
	};

	function translateData(data) {
		var filteredData = {};
		for (var rating in data) {
			if (rating && !isNaN(rating)) {

				filteredData[rating] = {};
				data[rating].filter(function (taggedWord) {
					return taggedWord[1] === 'JJ' && taggedWord[0][0] !== '\'';
				}).forEach(function (taggedAdjectives) {
					filteredData[rating][taggedAdjectives[0]] = ++filteredData[rating][taggedAdjectives[0]] || 1;
				});

				filteredData[rating] = Object.keys(filteredData[rating]).sort(function (a, b) {
					return filteredData[rating][a] - filteredData[rating][b];
				}).reverse().splice(0, 20);
			}
		};
		return filteredData;
	}

	$scope.createWords = function (stars) {
		$scope.currentWords = $scope.filteredData[stars];
		d3.select('#wordCloud').remove();
		var fill = d3.scale.category20();
		var layout = d3.layout.cloud().size([500, 500]).words($scope.currentWords.map(function (d) {
			return {
				text: d,
				size: 10 + Math.random() * 90,
				test: 'haha'
			};
		})).padding(5).rotate(function () {
			var negRandom = Math.random() < 0.5 ? -1 : 1;
			return ~ ~(Math.random() * 2) * 60 * negRandom;
		}).font('Helvetica Neue').fontSize(function (d) {
			return d.size;
		}).on('end', draw);
		layout.start();

		function draw(words) {
			d3.select('#demo').append('svg').attr('id', 'wordCloud').attr('width', layout.size()[0]).attr('height', layout.size()[1]).append('g').attr('transform', 'translate(' + layout.size()[0] / 2 + ',' + layout.size()[1] / 2 + ')').selectAll('text').data(words).enter().append('text').style('font-size', function (d) {
				return d.size + 'px';
			}).style('font-family', 'Helvetica Neue').style('fill', function (d, i) {
				return fill(i);
			}).attr('text-anchor', 'middle').attr('transform', function (d) {
				return 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')';
			}).text(function (d) {
				return d.text;
			});
		}
	};
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
'use strict';

app.controller('ModulesController', function ($scope, $http, ModulesFactory) {

  $scope.$on('$stateChangeSuccess', function () {
    var defaultMessage = 'If you don\'t see a list of links here, you need to seed your database!\nIn your terminal, go to this app\'s directory and run `gulp seedDB`.\nThen try this page again.';

    ModulesFactory.getNodeModules().then(function (modules) {
      $scope.nodeModules = modules;

      if (!$scope.nodeModules.length) {
        $scope.defaultMessage = defaultMessage;
      }
    });
  });
});
'use strict';

app.factory('ModulesFactory', function ($http) {
  return {
    getNodeModules: function getNodeModules() {
      return $http.get('/api/modules/').then(function (res) {
        return res.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('modules', {
        url: '/modules',
        templateUrl: '/app/modules/modules.html',
        controller: 'ModulesController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLnN0YXRlLmpzIiwibW9kdWxlcy9tb2R1bGVzLmNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL21vZHVsZXMuZmFjdG9yeS5qcyIsIm1vZHVsZXMvbW9kdWxlcy5zdGF0ZS5qcyIsIm5hdmJhci9uYXZiYXIuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQzs7QUFFdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLGtCQUFrQixFQUFFLGlCQUFpQixFQUFFOztBQUV6RCxvQkFBaUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRWxDLHFCQUFrQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztDQUNwQyxDQUFDLENBQUM7OztBQ1BILEdBQUcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLEVBQUUsVUFBUyxNQUFNLEVBQUUsS0FBSyxFQUFFOztBQUV2RCxPQUFNLENBQUMsWUFBWSxDQUFDO0FBQ3BCLE9BQU0sQ0FBQyxZQUFZLENBQUM7QUFDcEIsT0FBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDbkIsT0FBTSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7QUFDcEIsT0FBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxVQUFVLFFBQVEsRUFBRSxRQUFRLEVBQUU7QUFDOUQsTUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsT0FBTztBQUM5QyxNQUFJLFFBQVEsS0FBSyxDQUFDLEVBQUU7QUFDbkIsU0FBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtHQUM1QixNQUFNO0FBQ04sU0FBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEdBQUMsQ0FBQyxD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QUFFaE0sa0JBQWMsQ0FBQyxjQUFjLEVBQUUsQ0FDNUIsSUFBSSxDQUFDLFVBQVMsT0FBTyxFQUFFO0FBQ3RCLFlBQU0sQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDOztBQUU3QixVQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUU7QUFDOUIsY0FBTSxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7T0FDeEM7S0FDRixDQUFDLENBQUM7R0FDTixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUM7OztBQ2RILEdBQUcsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsVUFBUyxLQUFLLEVBQUU7QUFDNUMsU0FBTztBQUNMLGtCQUFjLEVBQUUsMEJBQVc7QUFDekIsYUFBTyxLQUFLLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUM5QixJQUFJLENBQUMsVUFBUyxHQUFHLEVBQUU7QUFDbEIsZUFBTyxHQUFHLENBQUMsSUFBSSxDQUFDO09BQ2pCLENBQUMsQ0FBQztLQUNOO0dBQ0YsQ0FBQztDQUNILENBQUMsQ0FBQzs7O0FDVEgsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLGNBQWMsRUFBRTtBQUNqQyxrQkFBYyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUU7QUFDNUIsV0FBRyxFQUFFLFVBQVU7QUFDZixtQkFBVyxFQUFFLDJCQUEyQjtBQUN4QyxrQkFBVSxFQUFFLG1CQUFtQjtLQUNsQyxDQUFDLENBQUM7Q0FDTixDQUFDLENBQUM7OztBQ05ILEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLFlBQVU7QUFDakMsUUFBTztBQUNOLFVBQVEsRUFBRSxHQUFHO0FBQ2IsYUFBVyxFQUFFLHlCQUF5QjtFQUN0QyxDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ01lYW5pc2N1bGUnLCBbJ3VpLnJvdXRlcicsICd1aS5ib290c3RyYXAnXSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24gKCR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgIC8vIFRoaXMgdHVybnMgb2ZmIGhhc2hiYW5nIHVybHMgKC8jYWJvdXQpIGFuZCBjaGFuZ2VzIGl0IHRvIHNvbWV0aGluZyBub3JtYWwgKC9hYm91dClcbiAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbiAgIC8vIElmIHdlIGdvIHRvIGEgVVJMIHRoYXQgdWktcm91dGVyIGRvZXNuJ3QgaGF2ZSByZWdpc3RlcmVkLCBnbyB0byB0aGUgXCIvXCIgdXJsLlxuICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xufSk7IiwiYXBwLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCkge1xuXG5cdFx0JHNjb3BlLmZpbHRlcmVkRGF0YTtcblx0XHQkc2NvcGUuY3VycmVudFdvcmRzO1xuXHRcdCRzY29wZS5yYXRpbmcgPSB7fTtcblx0XHQkc2NvcGUuZG9uZSA9IGZhbHNlO1xuXHRcdCRzY29wZS4kd2F0Y2goJ3JhdGluZy5zZWxlY3RlZCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcblx0XHRcdGlmICghbmV3VmFsdWUgfHwgISRzY29wZS5maWx0ZXJlZERhdGEpIHJldHVybjtcblx0XHRcdGlmIChuZXdWYWx1ZSA9PT0gMSkge1xuXHRcdFx0XHQkc2NvcGUuY3JlYXRlV29yZHMobmV3VmFsdWUpXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkc2NvcGUuY3JlYXRlV29yZHMobmV3VmFsdWUvMik7XG5cdFx0XHR9XG5cdFx0fSlcblxuXHRcdCRzY29wZS5nZXRSZXZpZXdzID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0JGh0dHAuZ2V0KCcvYXBpL3Jldmlld3MnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0cmV0dXJuIEpTT04ucGFyc2UocmVzcG9uc2UuZGF0YSk7XG5cdFx0XHR9KVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0JHNjb3BlLmZpbHRlcmVkRGF0YSA9IHRyYW5zbGF0ZURhdGEoZGF0YSk7XG5cdFx0XHRcdCRzY29wZS5kb25lID0gdHJ1ZTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ0RhdGEgaGFzIGFycml2ZWQhJyk7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdFx0fSlcblx0XHR9XG5cblx0ZnVuY3Rpb24gdHJhbnNsYXRlRGF0YShkYXRhKSB7XG5cdFx0dmFyIGZpbHRlcmVkRGF0YSA9IHt9O1xuXHRcdGZvciAodmFyIHJhdGluZyBpbiBkYXRhKSB7XG5cdFx0XHRpZiAocmF0aW5nICYmICFpc05hTihyYXRpbmcpKSB7XG5cblx0XHRcdFx0ZmlsdGVyZWREYXRhW3JhdGluZ10gPSB7fTtcblx0XHRcdFx0ZGF0YVtyYXRpbmddXG5cdFx0XHRcdFx0LmZpbHRlcihmdW5jdGlvbih0YWdnZWRXb3JkKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdGFnZ2VkV29yZFsxXSA9PT0gJ0pKJyAmJiB0YWdnZWRXb3JkWzBdWzBdICE9PSBcIidcIjtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5mb3JFYWNoKGZ1bmN0aW9uKHRhZ2dlZEFkamVjdGl2ZXMpIHtcblx0XHRcdFx0XHRcdGZpbHRlcmVkRGF0YVtyYXRpbmddW3RhZ2dlZEFkamVjdGl2ZXNbMF1dID0gKytmaWx0ZXJlZERhdGFbcmF0aW5nXVt0YWdnZWRBZGplY3RpdmVzWzBdXSB8fCAxO1xuXHRcdFx0XHRcdH0pXG5cblx0XHRcdFx0ZmlsdGVyZWREYXRhW3JhdGluZ10gPSBPYmplY3Qua2V5cyhmaWx0ZXJlZERhdGFbcmF0aW5nXSkuc29ydChmdW5jdGlvbihhLCBiKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpbHRlcmVkRGF0YVtyYXRpbmddW2FdIC0gZmlsdGVyZWREYXRhW3JhdGluZ11bYl1cblx0XHRcdFx0fSkucmV2ZXJzZSgpLnNwbGljZSgwLCAyMCk7XG5cdFx0XHR9XG5cdFx0fTtcblx0XHRyZXR1cm4gZmlsdGVyZWREYXRhO1xuXHR9XG5cblx0JHNjb3BlLmNyZWF0ZVdvcmRzID0gZnVuY3Rpb24oc3RhcnMpIHtcblx0XHQkc2NvcGUuY3VycmVudFdvcmRzID0gJHNjb3BlLmZpbHRlcmVkRGF0YVtzdGFyc11cblx0XHRkMy5zZWxlY3QoXCIjd29yZENsb3VkXCIpLnJlbW92ZSgpO1xuXHRcdHZhciBmaWxsID0gZDMuc2NhbGUuY2F0ZWdvcnkyMCgpO1xuXHRcdHZhciBsYXlvdXQgPSBkMy5sYXlvdXQuY2xvdWQoKVxuXHRcdFx0LnNpemUoWzUwMCwgNTAwXSlcblx0XHRcdC53b3Jkcygkc2NvcGUuY3VycmVudFdvcmRzLm1hcChmdW5jdGlvbihkKSB7XG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0dGV4dDogZCxcblx0XHRcdFx0XHRzaXplOiAxMCArIE1hdGgucmFuZG9tKCkgKiA5MCxcblx0XHRcdFx0XHR0ZXN0OiBcImhhaGFcIlxuXHRcdFx0XHR9O1xuXHRcdFx0fSkpXG5cdFx0XHQucGFkZGluZyg1KVxuXHRcdFx0LnJvdGF0ZShmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIG5lZ1JhbmRvbSA9IE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtMSA6IDE7XG5cdFx0XHRcdHJldHVybiB+fihNYXRoLnJhbmRvbSgpICogMikgKiA2MCAqIG5lZ1JhbmRvbTtcblx0XHRcdH0pXG5cdFx0XHQuZm9udChcIkhlbHZldGljYSBOZXVlXCIpXG5cdFx0XHQuZm9udFNpemUoZnVuY3Rpb24oZCkge1xuXHRcdFx0XHRyZXR1cm4gZC5zaXplO1xuXHRcdFx0fSlcblx0XHRcdC5vbihcImVuZFwiLCBkcmF3KTtcblx0XHRsYXlvdXQuc3RhcnQoKTtcblxuXHRcdGZ1bmN0aW9uIGRyYXcod29yZHMpIHtcblx0XHRcdGQzLnNlbGVjdChcIiNkZW1vXCIpLmFwcGVuZChcInN2Z1wiKVxuXHRcdFx0XHQuYXR0cihcImlkXCIsXCJ3b3JkQ2xvdWRcIilcblx0XHRcdFx0LmF0dHIoXCJ3aWR0aFwiLCBsYXlvdXQuc2l6ZSgpWzBdKVxuXHRcdFx0XHQuYXR0cihcImhlaWdodFwiLCBsYXlvdXQuc2l6ZSgpWzFdKVxuXHRcdFx0XHQuYXBwZW5kKFwiZ1wiKVxuXHRcdFx0XHQuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIGxheW91dC5zaXplKClbMF0gLyAyICsgXCIsXCIgKyBsYXlvdXQuc2l6ZSgpWzFdIC8gMiArIFwiKVwiKVxuXHRcdFx0XHQuc2VsZWN0QWxsKFwidGV4dFwiKVxuXHRcdFx0XHQuZGF0YSh3b3Jkcylcblx0XHRcdFx0LmVudGVyKCkuYXBwZW5kKFwidGV4dFwiKVxuXHRcdFx0XHQuc3R5bGUoXCJmb250LXNpemVcIiwgZnVuY3Rpb24oZCkge1xuXHRcdFx0XHRcdHJldHVybiBkLnNpemUgKyBcInB4XCI7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5zdHlsZShcImZvbnQtZmFtaWx5XCIsIFwiSGVsdmV0aWNhIE5ldWVcIilcblx0XHRcdFx0LnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbihkLCBpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpbGwoaSk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcblx0XHRcdFx0LmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkge1xuXHRcdFx0XHRcdHJldHVybiBcInRyYW5zbGF0ZShcIiArIFtkLngsIGQueV0gKyBcIilyb3RhdGUoXCIgKyBkLnJvdGF0ZSArIFwiKVwiO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQudGV4dChmdW5jdGlvbihkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGQudGV4dDtcblx0XHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cbn0pOyIsImFwcC5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICAgIHVybDogJy8nLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9ob21lLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInXG4gICAgfSk7XG59KTsiLCJhcHAuY29udHJvbGxlcignTW9kdWxlc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBNb2R1bGVzRmFjdG9yeSkge1xuICBcbiAgJHNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZGVmYXVsdE1lc3NhZ2UgPSAnSWYgeW91IGRvblxcJ3Qgc2VlIGEgbGlzdCBvZiBsaW5rcyBoZXJlLCB5b3UgbmVlZCB0byBzZWVkIHlvdXIgZGF0YWJhc2UhXFxuSW4geW91ciB0ZXJtaW5hbCwgZ28gdG8gdGhpcyBhcHBcXCdzIGRpcmVjdG9yeSBhbmQgcnVuIGBndWxwIHNlZWREQmAuXFxuVGhlbiB0cnkgdGhpcyBwYWdlIGFnYWluLic7XG5cbiAgICBNb2R1bGVzRmFjdG9yeS5nZXROb2RlTW9kdWxlcygpXG4gICAgICAudGhlbihmdW5jdGlvbihtb2R1bGVzKSB7XG4gICAgICAgICRzY29wZS5ub2RlTW9kdWxlcyA9IG1vZHVsZXM7XG4gICAgICAgIFxuICAgICAgICBpZiAoISRzY29wZS5ub2RlTW9kdWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAkc2NvcGUuZGVmYXVsdE1lc3NhZ2UgPSBkZWZhdWx0TWVzc2FnZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH0pO1xufSk7IiwiYXBwLmZhY3RvcnkoJ01vZHVsZXNGYWN0b3J5JywgZnVuY3Rpb24oJGh0dHApIHtcbiAgcmV0dXJuIHtcbiAgICBnZXROb2RlTW9kdWxlczogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL21vZHVsZXMvJylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5kYXRhO1xuICAgICAgICB9KTsgICAgXG4gICAgfVxuICB9O1xufSk7IiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbW9kdWxlcycsIHtcbiAgICAgICAgdXJsOiAnL21vZHVsZXMnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvbW9kdWxlcy9tb2R1bGVzLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnTW9kdWxlc0NvbnRyb2xsZXInXG4gICAgfSk7XG59KTsiLCJhcHAuZGlyZWN0aXZlKFwibmF2YmFyXCIsIGZ1bmN0aW9uKCl7XG5cdHJldHVybiB7XG5cdFx0cmVzdHJpY3Q6IFwiRVwiLFxuXHRcdHRlbXBsYXRlVXJsOiBcIi9hcHAvbmF2YmFyL25hdmJhci5odG1sXCJcblx0fTtcbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==