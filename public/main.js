'use strict';

var app = angular.module('Meaniscule', ['ui.router', 'ui.bootstrap']);

app.config(function ($urlRouterProvider, $locationProvider) {
   // This turns off hashbang urls (/#about) and changes it to something normal (/about)
   $locationProvider.html5Mode(true);
   // If we go to a URL that ui-router doesn't have registered, go to the "/" url.
   $urlRouterProvider.otherwise('/');
});
'use strict';

app.controller('HomeController', function ($scope, $http) {

	$scope.filteredData;
	$scope.currentWords;
	$scope.rating = {};

	$scope.$watch('rating.selected', function (newValue, oldValue) {
		if (!newValue || !$scope.filteredData) return;
		if (newValue === 1) {
			$scope.createWords(newValue);
		} else {
			$scope.createWords(newValue / 2);
		}
	});

	$http.get('/api/reviews').then(function (response) {
		return JSON.parse(response.data);
	}).then(function (data) {
		$scope.filteredData = translateData(data);
	})['catch'](function (err) {
		console.error(err);
	});

	function translateData(data) {
		var filteredData = {};
		for (var rating in data) {
			if (rating && !isNaN(rating)) {

				filteredData[rating] = {};
				data[rating].filter(function (taggedWord) {
					return taggedWord[1] === 'JJ' && taggedWord[0][0] !== '\'';
				}).forEach(function (taggedAdjectives) {
					filteredData[rating][taggedAdjectives[0]] = ++filteredData[rating][taggedAdjectives[0]] || 1;
				});

				filteredData[rating] = Object.keys(filteredData[rating]).sort(function (a, b) {
					return filteredData[rating][a] - filteredData[rating][b];
				}).reverse().splice(0, 20);
			}
		};
		return filteredData;
	}

	$scope.createWords = function (stars) {
		$scope.currentWords = $scope.filteredData[stars];
		d3.select('#wordCloud').remove();
		var fill = d3.scale.category20();
		var layout = d3.layout.cloud().size([500, 500]).words($scope.currentWords.map(function (d) {
			return {
				text: d,
				size: 10 + Math.random() * 90,
				test: 'haha'
			};
		})).padding(5).rotate(function () {
			var negRandom = Math.random() < 0.5 ? -1 : 1;
			return ~ ~(Math.random() * 2) * 60 * negRandom;
		}).font('Helvetica Neue').fontSize(function (d) {
			return d.size;
		}).on('end', draw);
		layout.start();

		function draw(words) {
			d3.select('#demo').append('svg').attr('id', 'wordCloud').attr('width', layout.size()[0]).attr('height', layout.size()[1]).append('g').attr('transform', 'translate(' + layout.size()[0] / 2 + ',' + layout.size()[1] / 2 + ')').selectAll('text').data(words).enter().append('text').style('font-size', function (d) {
				return d.size + 'px';
			}).style('font-family', 'Helvetica Neue').style('fill', function (d, i) {
				return fill(i);
			}).attr('text-anchor', 'middle').attr('transform', function (d) {
				return 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')';
			}).text(function (d) {
				return d.text;
			});
		}
	};
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('home', {
        url: '/',
        templateUrl: '/app/home/home.html',
        controller: 'HomeController'
    });
});
'use strict';

app.controller('ModulesController', function ($scope, $http, ModulesFactory) {

  $scope.$on('$stateChangeSuccess', function () {
    var defaultMessage = 'If you don\'t see a list of links here, you need to seed your database!\nIn your terminal, go to this app\'s directory and run `gulp seedDB`.\nThen try this page again.';

    ModulesFactory.getNodeModules().then(function (modules) {
      $scope.nodeModules = modules;

      if (!$scope.nodeModules.length) {
        $scope.defaultMessage = defaultMessage;
      }
    });
  });
});
'use strict';

app.factory('ModulesFactory', function ($http) {
  return {
    getNodeModules: function getNodeModules() {
      return $http.get('/api/modules/').then(function (res) {
        return res.data;
      });
    }
  };
});
'use strict';

app.config(function ($stateProvider) {
    $stateProvider.state('modules', {
        url: '/modules',
        templateUrl: '/app/modules/modules.html',
        controller: 'ModulesController'
    });
});
"use strict";

app.directive("navbar", function () {
	return {
		restrict: "E",
		templateUrl: "/app/navbar/navbar.html"
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lLnN0YXRlLmpzIiwibW9kdWxlcy9tb2R1bGVzLmNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL21vZHVsZXMuZmFjdG9yeS5qcyIsIm1vZHVsZXMvbW9kdWxlcy5zdGF0ZS5qcyIsIm5hdmJhci9uYXZiYXIuZGlyZWN0aXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQzs7QUFFdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLGtCQUFrQixFQUFFLGlCQUFpQixFQUFFOztBQUV6RCxvQkFBaUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRWxDLHFCQUFrQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztDQUNwQyxDQUFDLENBQUM7OztBQ1BILEdBQUcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLEVBQUUsVUFBUyxNQUFNLEVBQUUsS0FBSyxFQUFFOztBQUV2RCxPQUFNLENBQUMsWUFBWSxDQUFDO0FBQ3BCLE9BQU0sQ0FBQyxZQUFZLENBQUM7QUFDcEIsT0FBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7O0FBRW5CLE9BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsVUFBVSxRQUFRLEVBQUUsUUFBUSxFQUFFO0FBQzlELE1BQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLE9BQU87QUFDOUMsTUFBSSxRQUFRLEtBQUssQ0FBQyxFQUFFO0FBQ25CLFNBQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUE7R0FDNUIsTUFBTTtBQUNOLFNBQU0sQ0FBQyxXQUFXLENBQUMsUUFBUSxHQUFDLENBQUMsQ0FBQyxDQUFDO0dBQy9CO0VBQ0QsQ0FBQyxDQUFBOztBQUVG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QyxjQUFjLEdBQUcsY0FBYyxDQUFDO09BQ3hDO0tBQ0YsQ0FBQyxDQUFDO0dBQ04sQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDOzs7QUNkSCxHQUFHLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLFVBQVMsS0FBSyxFQUFFO0FBQzVDLFNBQU87QUFDTCxrQkFBYyxFQUFFLDBCQUFXO0FBQ3pCLGFBQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FDOUIsSUFBSSxDQUFDLFVBQVMsR0FBRyxFQUFFO0FBQ2xCLGVBQU8sR0FBRyxDQUFDLElBQUksQ0FBQztPQUNqQixDQUFDLENBQUM7S0FDTjtHQUNGLENBQUM7Q0FDSCxDQUFDLENBQUM7OztBQ1RILEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxjQUFjLEVBQUU7QUFDakMsa0JBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFO0FBQzVCLFdBQUcsRUFBRSxVQUFVO0FBQ2YsbUJBQVcsRUFBRSwyQkFBMkI7QUFDeEMsa0JBQVUsRUFBRSxtQkFBbUI7S0FDbEMsQ0FBQyxDQUFDO0NBQ04sQ0FBQyxDQUFDOzs7QUNOSCxHQUFHLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxZQUFVO0FBQ2pDLFFBQU87QUFDTixVQUFRLEVBQUUsR0FBRztBQUNiLGFBQVcsRUFBRSx5QkFBeUI7RUFDdEMsQ0FBQztDQUNGLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdNZWFuaXNjdWxlJywgWyd1aS5yb3V0ZXInLCAndWkuYm9vdHN0cmFwJ10pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAvLyBUaGlzIHR1cm5zIG9mZiBoYXNoYmFuZyB1cmxzICgvI2Fib3V0KSBhbmQgY2hhbmdlcyBpdCB0byBzb21ldGhpbmcgbm9ybWFsICgvYWJvdXQpXG4gICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAvLyBJZiB3ZSBnbyB0byBhIFVSTCB0aGF0IHVpLXJvdXRlciBkb2Vzbid0IGhhdmUgcmVnaXN0ZXJlZCwgZ28gdG8gdGhlIFwiL1wiIHVybC5cbiAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcblxuXHRcdCRzY29wZS5maWx0ZXJlZERhdGE7XG5cdFx0JHNjb3BlLmN1cnJlbnRXb3Jkcztcblx0XHQkc2NvcGUucmF0aW5nID0ge307XG5cdFx0XG5cdFx0JHNjb3BlLiR3YXRjaCgncmF0aW5nLnNlbGVjdGVkJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuXHRcdFx0aWYgKCFuZXdWYWx1ZSB8fCAhJHNjb3BlLmZpbHRlcmVkRGF0YSkgcmV0dXJuO1xuXHRcdFx0aWYgKG5ld1ZhbHVlID09PSAxKSB7XG5cdFx0XHRcdCRzY29wZS5jcmVhdGVXb3JkcyhuZXdWYWx1ZSlcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRzY29wZS5jcmVhdGVXb3JkcyhuZXdWYWx1ZS8yKTtcblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0JGh0dHAuZ2V0KCcvYXBpL3Jldmlld3MnKVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0cmV0dXJuIEpTT04ucGFyc2UocmVzcG9uc2UuZGF0YSk7XG5cdFx0XHR9KVxuXHRcdFx0LnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblx0XHRcdFx0JHNjb3BlLmZpbHRlcmVkRGF0YSA9IHRyYW5zbGF0ZURhdGEoZGF0YSk7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdFx0fSlcblxuXHRmdW5jdGlvbiB0cmFuc2xhdGVEYXRhKGRhdGEpIHtcblx0XHR2YXIgZmlsdGVyZWREYXRhID0ge307XG5cdFx0Zm9yICh2YXIgcmF0aW5nIGluIGRhdGEpIHtcblx0XHRcdGlmIChyYXRpbmcgJiYgIWlzTmFOKHJhdGluZykpIHtcblxuXHRcdFx0XHRmaWx0ZXJlZERhdGFbcmF0aW5nXSA9IHt9O1xuXHRcdFx0XHRkYXRhW3JhdGluZ11cblx0XHRcdFx0XHQuZmlsdGVyKGZ1bmN0aW9uKHRhZ2dlZFdvcmQpIHtcblx0XHRcdFx0XHRcdHJldHVybiB0YWdnZWRXb3JkWzFdID09PSAnSkonICYmIHRhZ2dlZFdvcmRbMF1bMF0gIT09IFwiJ1wiO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmZvckVhY2goZnVuY3Rpb24odGFnZ2VkQWRqZWN0aXZlcykge1xuXHRcdFx0XHRcdFx0ZmlsdGVyZWREYXRhW3JhdGluZ11bdGFnZ2VkQWRqZWN0aXZlc1swXV0gPSArK2ZpbHRlcmVkRGF0YVtyYXRpbmddW3RhZ2dlZEFkamVjdGl2ZXNbMF1dIHx8IDE7XG5cdFx0XHRcdFx0fSlcblxuXHRcdFx0XHRmaWx0ZXJlZERhdGFbcmF0aW5nXSA9IE9iamVjdC5rZXlzKGZpbHRlcmVkRGF0YVtyYXRpbmddKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsdGVyZWREYXRhW3JhdGluZ11bYV0gLSBmaWx0ZXJlZERhdGFbcmF0aW5nXVtiXVxuXHRcdFx0XHR9KS5yZXZlcnNlKCkuc3BsaWNlKDAsIDIwKTtcblx0XHRcdH1cblx0XHR9O1xuXHRcdHJldHVybiBmaWx0ZXJlZERhdGE7XG5cdH1cblxuXHQkc2NvcGUuY3JlYXRlV29yZHMgPSBmdW5jdGlvbihzdGFycykge1xuXHRcdCRzY29wZS5jdXJyZW50V29yZHMgPSAkc2NvcGUuZmlsdGVyZWREYXRhW3N0YXJzXVxuXHRcdGQzLnNlbGVjdChcIiN3b3JkQ2xvdWRcIikucmVtb3ZlKCk7XG5cdFx0dmFyIGZpbGwgPSBkMy5zY2FsZS5jYXRlZ29yeTIwKCk7XG5cdFx0dmFyIGxheW91dCA9IGQzLmxheW91dC5jbG91ZCgpXG5cdFx0XHQuc2l6ZShbNTAwLCA1MDBdKVxuXHRcdFx0LndvcmRzKCRzY29wZS5jdXJyZW50V29yZHMubWFwKGZ1bmN0aW9uKGQpIHtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHR0ZXh0OiBkLFxuXHRcdFx0XHRcdHNpemU6IDEwICsgTWF0aC5yYW5kb20oKSAqIDkwLFxuXHRcdFx0XHRcdHRlc3Q6IFwiaGFoYVwiXG5cdFx0XHRcdH07XG5cdFx0XHR9KSlcblx0XHRcdC5wYWRkaW5nKDUpXG5cdFx0XHQucm90YXRlKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgbmVnUmFuZG9tID0gTWF0aC5yYW5kb20oKSA8IDAuNSA/IC0xIDogMTtcblx0XHRcdFx0cmV0dXJuIH5+KE1hdGgucmFuZG9tKCkgKiAyKSAqIDYwICogbmVnUmFuZG9tO1xuXHRcdFx0fSlcblx0XHRcdC5mb250KFwiSGVsdmV0aWNhIE5ldWVcIilcblx0XHRcdC5mb250U2l6ZShmdW5jdGlvbihkKSB7XG5cdFx0XHRcdHJldHVybiBkLnNpemU7XG5cdFx0XHR9KVxuXHRcdFx0Lm9uKFwiZW5kXCIsIGRyYXcpO1xuXHRcdGxheW91dC5zdGFydCgpO1xuXG5cdFx0ZnVuY3Rpb24gZHJhdyh3b3Jkcykge1xuXHRcdFx0ZDMuc2VsZWN0KFwiI2RlbW9cIikuYXBwZW5kKFwic3ZnXCIpXG5cdFx0XHRcdC5hdHRyKFwiaWRcIixcIndvcmRDbG91ZFwiKVxuXHRcdFx0XHQuYXR0cihcIndpZHRoXCIsIGxheW91dC5zaXplKClbMF0pXG5cdFx0XHRcdC5hdHRyKFwiaGVpZ2h0XCIsIGxheW91dC5zaXplKClbMV0pXG5cdFx0XHRcdC5hcHBlbmQoXCJnXCIpXG5cdFx0XHRcdC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbGF5b3V0LnNpemUoKVswXSAvIDIgKyBcIixcIiArIGxheW91dC5zaXplKClbMV0gLyAyICsgXCIpXCIpXG5cdFx0XHRcdC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG5cdFx0XHRcdC5kYXRhKHdvcmRzKVxuXHRcdFx0XHQuZW50ZXIoKS5hcHBlbmQoXCJ0ZXh0XCIpXG5cdFx0XHRcdC5zdHlsZShcImZvbnQtc2l6ZVwiLCBmdW5jdGlvbihkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGQuc2l6ZSArIFwicHhcIjtcblx0XHRcdFx0fSlcblx0XHRcdFx0LnN0eWxlKFwiZm9udC1mYW1pbHlcIiwgXCJIZWx2ZXRpY2EgTmV1ZVwiKVxuXHRcdFx0XHQuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uKGQsIGkpIHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsbChpKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0LmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuXHRcdFx0XHQuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFwidHJhbnNsYXRlKFwiICsgW2QueCwgZC55XSArIFwiKXJvdGF0ZShcIiArIGQucm90YXRlICsgXCIpXCI7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50ZXh0KGZ1bmN0aW9uKGQpIHtcblx0XHRcdFx0XHRyZXR1cm4gZC50ZXh0O1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH1cblxufSk7IiwiYXBwLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnaG9tZScsIHtcbiAgICAgICAgdXJsOiAnLycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2hvbWUuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcidcbiAgICB9KTtcbn0pOyIsImFwcC5jb250cm9sbGVyKCdNb2R1bGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIE1vZHVsZXNGYWN0b3J5KSB7XG4gIFxuICAkc2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBkZWZhdWx0TWVzc2FnZSA9ICdJZiB5b3UgZG9uXFwndCBzZWUgYSBsaXN0IG9mIGxpbmtzIGhlcmUsIHlvdSBuZWVkIHRvIHNlZWQgeW91ciBkYXRhYmFzZSFcXG5JbiB5b3VyIHRlcm1pbmFsLCBnbyB0byB0aGlzIGFwcFxcJ3MgZGlyZWN0b3J5IGFuZCBydW4gYGd1bHAgc2VlZERCYC5cXG5UaGVuIHRyeSB0aGlzIHBhZ2UgYWdhaW4uJztcblxuICAgIE1vZHVsZXNGYWN0b3J5LmdldE5vZGVNb2R1bGVzKClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKG1vZHVsZXMpIHtcbiAgICAgICAgJHNjb3BlLm5vZGVNb2R1bGVzID0gbW9kdWxlcztcbiAgICAgICAgXG4gICAgICAgIGlmICghJHNjb3BlLm5vZGVNb2R1bGVzLmxlbmd0aCkge1xuICAgICAgICAgICRzY29wZS5kZWZhdWx0TWVzc2FnZSA9IGRlZmF1bHRNZXNzYWdlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfSk7XG59KTsiLCJhcHAuZmFjdG9yeSgnTW9kdWxlc0ZhY3RvcnknLCBmdW5jdGlvbigkaHR0cCkge1xuICByZXR1cm4ge1xuICAgIGdldE5vZGVNb2R1bGVzOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvbW9kdWxlcy8nKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmRhdGE7XG4gICAgICAgIH0pOyAgICBcbiAgICB9XG4gIH07XG59KTsiLCJhcHAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdtb2R1bGVzJywge1xuICAgICAgICB1cmw6ICcvbW9kdWxlcycsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9tb2R1bGVzL21vZHVsZXMuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdNb2R1bGVzQ29udHJvbGxlcidcbiAgICB9KTtcbn0pOyIsImFwcC5kaXJlY3RpdmUoXCJuYXZiYXJcIiwgZnVuY3Rpb24oKXtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogXCJFXCIsXG5cdFx0dGVtcGxhdGVVcmw6IFwiL2FwcC9uYXZiYXIvbmF2YmFyLmh0bWxcIlxuXHR9O1xufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9